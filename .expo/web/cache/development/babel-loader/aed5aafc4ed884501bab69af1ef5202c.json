{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport { EventEmitter, UnavailabilityError } from 'expo-modules-core';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { v4 as uuidv4 } from 'uuid';\nimport ExponentFileSystem from \"./ExponentFileSystem\";\nimport { EncodingType, FileSystemSessionType, FileSystemUploadType } from \"./FileSystem.types\";\nif (!ExponentFileSystem) {\n  console.warn(\"No native ExponentFileSystem module found, are you sure the expo-file-system's module is linked properly?\");\n}\nvar _unused = new EventEmitter(ExponentFileSystem);\nexport { EncodingType, FileSystemSessionType, FileSystemUploadType };\nfunction normalizeEndingSlash(p) {\n  if (p != null) {\n    return p.replace(/\\/*$/, '') + '/';\n  }\n  return null;\n}\nexport var documentDirectory = normalizeEndingSlash(ExponentFileSystem.documentDirectory);\nexport var cacheDirectory = normalizeEndingSlash(ExponentFileSystem.cacheDirectory);\nvar bundledAssets = ExponentFileSystem.bundledAssets,\n  bundleDirectory = ExponentFileSystem.bundleDirectory;\nexport { bundledAssets, bundleDirectory };\nexport function getInfoAsync(_x) {\n  return _getInfoAsync.apply(this, arguments);\n}\nfunction _getInfoAsync() {\n  _getInfoAsync = _asyncToGenerator(function* (fileUri) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!ExponentFileSystem.getInfoAsync) {\n      throw new UnavailabilityError('expo-file-system', 'getInfoAsync');\n    }\n    return yield ExponentFileSystem.getInfoAsync(fileUri, options);\n  });\n  return _getInfoAsync.apply(this, arguments);\n}\nexport function readAsStringAsync(_x2, _x3) {\n  return _readAsStringAsync.apply(this, arguments);\n}\nfunction _readAsStringAsync() {\n  _readAsStringAsync = _asyncToGenerator(function* (fileUri, options) {\n    if (!ExponentFileSystem.readAsStringAsync) {\n      throw new UnavailabilityError('expo-file-system', 'readAsStringAsync');\n    }\n    return yield ExponentFileSystem.readAsStringAsync(fileUri, options || {});\n  });\n  return _readAsStringAsync.apply(this, arguments);\n}\nexport function getContentUriAsync(_x4) {\n  return _getContentUriAsync.apply(this, arguments);\n}\nfunction _getContentUriAsync() {\n  _getContentUriAsync = _asyncToGenerator(function* (fileUri) {\n    if (Platform.OS === 'android') {\n      if (!ExponentFileSystem.getContentUriAsync) {\n        throw new UnavailabilityError('expo-file-system', 'getContentUriAsync');\n      }\n      return yield ExponentFileSystem.getContentUriAsync(fileUri);\n    } else {\n      return new Promise(function (resolve, reject) {\n        resolve(fileUri);\n      });\n    }\n  });\n  return _getContentUriAsync.apply(this, arguments);\n}\nexport function writeAsStringAsync(_x5, _x6) {\n  return _writeAsStringAsync.apply(this, arguments);\n}\nfunction _writeAsStringAsync() {\n  _writeAsStringAsync = _asyncToGenerator(function* (fileUri, contents) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (!ExponentFileSystem.writeAsStringAsync) {\n      throw new UnavailabilityError('expo-file-system', 'writeAsStringAsync');\n    }\n    return yield ExponentFileSystem.writeAsStringAsync(fileUri, contents, options);\n  });\n  return _writeAsStringAsync.apply(this, arguments);\n}\nexport function deleteAsync(_x7) {\n  return _deleteAsync.apply(this, arguments);\n}\nfunction _deleteAsync() {\n  _deleteAsync = _asyncToGenerator(function* (fileUri) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!ExponentFileSystem.deleteAsync) {\n      throw new UnavailabilityError('expo-file-system', 'deleteAsync');\n    }\n    return yield ExponentFileSystem.deleteAsync(fileUri, options);\n  });\n  return _deleteAsync.apply(this, arguments);\n}\nexport function deleteLegacyDocumentDirectoryAndroid() {\n  return _deleteLegacyDocumentDirectoryAndroid.apply(this, arguments);\n}\nfunction _deleteLegacyDocumentDirectoryAndroid() {\n  _deleteLegacyDocumentDirectoryAndroid = _asyncToGenerator(function* () {\n    if (Platform.OS !== 'android' || documentDirectory == null) {\n      return;\n    }\n    var legacyDocumentDirectory = documentDirectory + \"ExperienceData/\";\n    return yield deleteAsync(legacyDocumentDirectory, {\n      idempotent: true\n    });\n  });\n  return _deleteLegacyDocumentDirectoryAndroid.apply(this, arguments);\n}\nexport function moveAsync(_x8) {\n  return _moveAsync.apply(this, arguments);\n}\nfunction _moveAsync() {\n  _moveAsync = _asyncToGenerator(function* (options) {\n    if (!ExponentFileSystem.moveAsync) {\n      throw new UnavailabilityError('expo-file-system', 'moveAsync');\n    }\n    return yield ExponentFileSystem.moveAsync(options);\n  });\n  return _moveAsync.apply(this, arguments);\n}\nexport function copyAsync(_x9) {\n  return _copyAsync.apply(this, arguments);\n}\nfunction _copyAsync() {\n  _copyAsync = _asyncToGenerator(function* (options) {\n    if (!ExponentFileSystem.copyAsync) {\n      throw new UnavailabilityError('expo-file-system', 'copyAsync');\n    }\n    return yield ExponentFileSystem.copyAsync(options);\n  });\n  return _copyAsync.apply(this, arguments);\n}\nexport function makeDirectoryAsync(_x10) {\n  return _makeDirectoryAsync.apply(this, arguments);\n}\nfunction _makeDirectoryAsync() {\n  _makeDirectoryAsync = _asyncToGenerator(function* (fileUri) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!ExponentFileSystem.makeDirectoryAsync) {\n      throw new UnavailabilityError('expo-file-system', 'makeDirectoryAsync');\n    }\n    return yield ExponentFileSystem.makeDirectoryAsync(fileUri, options);\n  });\n  return _makeDirectoryAsync.apply(this, arguments);\n}\nexport function readDirectoryAsync(_x11) {\n  return _readDirectoryAsync.apply(this, arguments);\n}\nfunction _readDirectoryAsync() {\n  _readDirectoryAsync = _asyncToGenerator(function* (fileUri) {\n    if (!ExponentFileSystem.readDirectoryAsync) {\n      throw new UnavailabilityError('expo-file-system', 'readDirectoryAsync');\n    }\n    return yield ExponentFileSystem.readDirectoryAsync(fileUri, {});\n  });\n  return _readDirectoryAsync.apply(this, arguments);\n}\nexport function getFreeDiskStorageAsync() {\n  return _getFreeDiskStorageAsync.apply(this, arguments);\n}\nfunction _getFreeDiskStorageAsync() {\n  _getFreeDiskStorageAsync = _asyncToGenerator(function* () {\n    if (!ExponentFileSystem.getFreeDiskStorageAsync) {\n      throw new UnavailabilityError('expo-file-system', 'getFreeDiskStorageAsync');\n    }\n    return yield ExponentFileSystem.getFreeDiskStorageAsync();\n  });\n  return _getFreeDiskStorageAsync.apply(this, arguments);\n}\nexport function getTotalDiskCapacityAsync() {\n  return _getTotalDiskCapacityAsync.apply(this, arguments);\n}\nfunction _getTotalDiskCapacityAsync() {\n  _getTotalDiskCapacityAsync = _asyncToGenerator(function* () {\n    if (!ExponentFileSystem.getTotalDiskCapacityAsync) {\n      throw new UnavailabilityError('expo-file-system', 'getTotalDiskCapacityAsync');\n    }\n    return yield ExponentFileSystem.getTotalDiskCapacityAsync();\n  });\n  return _getTotalDiskCapacityAsync.apply(this, arguments);\n}\nexport function downloadAsync(_x12, _x13) {\n  return _downloadAsync.apply(this, arguments);\n}\nfunction _downloadAsync() {\n  _downloadAsync = _asyncToGenerator(function* (uri, fileUri) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (!ExponentFileSystem.downloadAsync) {\n      throw new UnavailabilityError('expo-file-system', 'downloadAsync');\n    }\n    return yield ExponentFileSystem.downloadAsync(uri, fileUri, _objectSpread({\n      sessionType: FileSystemSessionType.BACKGROUND\n    }, options));\n  });\n  return _downloadAsync.apply(this, arguments);\n}\nexport function uploadAsync(_x14, _x15) {\n  return _uploadAsync.apply(this, arguments);\n}\nfunction _uploadAsync() {\n  _uploadAsync = _asyncToGenerator(function* (url, fileUri) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (!ExponentFileSystem.uploadAsync) {\n      throw new UnavailabilityError('expo-file-system', 'uploadAsync');\n    }\n    return yield ExponentFileSystem.uploadAsync(url, fileUri, _objectSpread(_objectSpread({\n      sessionType: FileSystemSessionType.BACKGROUND,\n      uploadType: FileSystemUploadType.BINARY_CONTENT\n    }, options), {}, {\n      httpMethod: (options.httpMethod || 'POST').toUpperCase()\n    }));\n  });\n  return _uploadAsync.apply(this, arguments);\n}\nexport function createDownloadResumable(uri, fileUri, options, callback, resumeData) {\n  return new DownloadResumable(uri, fileUri, options, callback, resumeData);\n}\nexport function createUploadTask(url, fileUri, options, callback) {\n  return new UploadTask(url, fileUri, options, callback);\n}\nexport var FileSystemCancellableNetworkTask = function () {\n  function FileSystemCancellableNetworkTask() {\n    _classCallCheck(this, FileSystemCancellableNetworkTask);\n    this._uuid = uuidv4();\n    this.taskWasCanceled = false;\n    this.emitter = new EventEmitter(ExponentFileSystem);\n  }\n  _createClass(FileSystemCancellableNetworkTask, [{\n    key: \"cancelAsync\",\n    value: function () {\n      var _cancelAsync = _asyncToGenerator(function* () {\n        if (!ExponentFileSystem.networkTaskCancelAsync) {\n          throw new UnavailabilityError('expo-file-system', 'networkTaskCancelAsync');\n        }\n        this.removeSubscription();\n        this.taskWasCanceled = true;\n        return yield ExponentFileSystem.networkTaskCancelAsync(this.uuid);\n      });\n      function cancelAsync() {\n        return _cancelAsync.apply(this, arguments);\n      }\n      return cancelAsync;\n    }()\n  }, {\n    key: \"isTaskCancelled\",\n    value: function isTaskCancelled() {\n      if (this.taskWasCanceled) {\n        console.warn('This task was already canceled.');\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"uuid\",\n    get: function get() {\n      return this._uuid;\n    }\n  }, {\n    key: \"addSubscription\",\n    value: function addSubscription() {\n      var _this = this;\n      if (this.subscription) {\n        return;\n      }\n      this.subscription = this.emitter.addListener(this.getEventName(), function (event) {\n        if (event.uuid === _this.uuid) {\n          var callback = _this.getCallback();\n          if (callback) {\n            callback(event.data);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"removeSubscription\",\n    value: function removeSubscription() {\n      if (!this.subscription) {\n        return;\n      }\n      this.emitter.removeSubscription(this.subscription);\n      this.subscription = null;\n    }\n  }]);\n  return FileSystemCancellableNetworkTask;\n}();\nexport var UploadTask = function (_FileSystemCancellabl) {\n  _inherits(UploadTask, _FileSystemCancellabl);\n  var _super = _createSuper(UploadTask);\n  function UploadTask(url, fileUri, options, callback) {\n    var _options$httpMethod;\n    var _this2;\n    _classCallCheck(this, UploadTask);\n    _this2 = _super.call(this);\n    _this2.url = url;\n    _this2.fileUri = fileUri;\n    _this2.callback = callback;\n    var httpMethod = (options == null ? void 0 : (_options$httpMethod = options.httpMethod) == null ? void 0 : _options$httpMethod.toUpperCase()) || 'POST';\n    _this2.options = _objectSpread(_objectSpread({\n      sessionType: FileSystemSessionType.BACKGROUND,\n      uploadType: FileSystemUploadType.BINARY_CONTENT\n    }, options), {}, {\n      httpMethod: httpMethod\n    });\n    return _this2;\n  }\n  _createClass(UploadTask, [{\n    key: \"getEventName\",\n    value: function getEventName() {\n      return 'expo-file-system.uploadProgress';\n    }\n  }, {\n    key: \"getCallback\",\n    value: function getCallback() {\n      return this.callback;\n    }\n  }, {\n    key: \"uploadAsync\",\n    value: function () {\n      var _uploadAsync2 = _asyncToGenerator(function* () {\n        if (!ExponentFileSystem.uploadTaskStartAsync) {\n          throw new UnavailabilityError('expo-file-system', 'uploadTaskStartAsync');\n        }\n        if (this.isTaskCancelled()) {\n          return;\n        }\n        this.addSubscription();\n        var result = yield ExponentFileSystem.uploadTaskStartAsync(this.url, this.fileUri, this.uuid, this.options);\n        this.removeSubscription();\n        return result;\n      });\n      function uploadAsync() {\n        return _uploadAsync2.apply(this, arguments);\n      }\n      return uploadAsync;\n    }()\n  }]);\n  return UploadTask;\n}(FileSystemCancellableNetworkTask);\nexport var DownloadResumable = function (_FileSystemCancellabl2) {\n  _inherits(DownloadResumable, _FileSystemCancellabl2);\n  var _super2 = _createSuper(DownloadResumable);\n  function DownloadResumable(url, _fileUri) {\n    var _this3;\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var callback = arguments.length > 3 ? arguments[3] : undefined;\n    var resumeData = arguments.length > 4 ? arguments[4] : undefined;\n    _classCallCheck(this, DownloadResumable);\n    _this3 = _super2.call(this);\n    _this3.url = url;\n    _this3._fileUri = _fileUri;\n    _this3.options = options;\n    _this3.callback = callback;\n    _this3.resumeData = resumeData;\n    return _this3;\n  }\n  _createClass(DownloadResumable, [{\n    key: \"fileUri\",\n    get: function get() {\n      return this._fileUri;\n    }\n  }, {\n    key: \"getEventName\",\n    value: function getEventName() {\n      return 'expo-file-system.downloadProgress';\n    }\n  }, {\n    key: \"getCallback\",\n    value: function getCallback() {\n      return this.callback;\n    }\n  }, {\n    key: \"downloadAsync\",\n    value: function () {\n      var _downloadAsync2 = _asyncToGenerator(function* () {\n        if (!ExponentFileSystem.downloadResumableStartAsync) {\n          throw new UnavailabilityError('expo-file-system', 'downloadResumableStartAsync');\n        }\n        if (this.isTaskCancelled()) {\n          return;\n        }\n        this.addSubscription();\n        return yield ExponentFileSystem.downloadResumableStartAsync(this.url, this._fileUri, this.uuid, this.options, this.resumeData);\n      });\n      function downloadAsync() {\n        return _downloadAsync2.apply(this, arguments);\n      }\n      return downloadAsync;\n    }()\n  }, {\n    key: \"pauseAsync\",\n    value: function () {\n      var _pauseAsync = _asyncToGenerator(function* () {\n        if (!ExponentFileSystem.downloadResumablePauseAsync) {\n          throw new UnavailabilityError('expo-file-system', 'downloadResumablePauseAsync');\n        }\n        if (this.isTaskCancelled()) {\n          return {\n            fileUri: this._fileUri,\n            options: this.options,\n            url: this.url\n          };\n        }\n        var pauseResult = yield ExponentFileSystem.downloadResumablePauseAsync(this.uuid);\n        this.removeSubscription();\n        if (pauseResult) {\n          this.resumeData = pauseResult.resumeData;\n          return this.savable();\n        } else {\n          throw new Error('Unable to generate a savable pause state');\n        }\n      });\n      function pauseAsync() {\n        return _pauseAsync.apply(this, arguments);\n      }\n      return pauseAsync;\n    }()\n  }, {\n    key: \"resumeAsync\",\n    value: function () {\n      var _resumeAsync = _asyncToGenerator(function* () {\n        if (!ExponentFileSystem.downloadResumableStartAsync) {\n          throw new UnavailabilityError('expo-file-system', 'downloadResumableStartAsync');\n        }\n        if (this.isTaskCancelled()) {\n          return;\n        }\n        this.addSubscription();\n        return yield ExponentFileSystem.downloadResumableStartAsync(this.url, this.fileUri, this.uuid, this.options, this.resumeData);\n      });\n      function resumeAsync() {\n        return _resumeAsync.apply(this, arguments);\n      }\n      return resumeAsync;\n    }()\n  }, {\n    key: \"savable\",\n    value: function savable() {\n      return {\n        url: this.url,\n        fileUri: this.fileUri,\n        options: this.options,\n        resumeData: this.resumeData\n      };\n    }\n  }]);\n  return DownloadResumable;\n}(FileSystemCancellableNetworkTask);\nvar baseReadAsStringAsync = readAsStringAsync;\nvar baseWriteAsStringAsync = writeAsStringAsync;\nvar baseDeleteAsync = deleteAsync;\nvar baseMoveAsync = moveAsync;\nvar baseCopyAsync = copyAsync;\nexport var StorageAccessFramework;\n(function (StorageAccessFramework) {\n  function getUriForDirectoryInRoot(folderName) {\n    return \"content://com.android.externalstorage.documents/tree/primary:\" + folderName + \"/document/primary:\" + folderName;\n  }\n  StorageAccessFramework.getUriForDirectoryInRoot = getUriForDirectoryInRoot;\n  function requestDirectoryPermissionsAsync() {\n    return _requestDirectoryPermissionsAsync.apply(this, arguments);\n  }\n  function _requestDirectoryPermissionsAsync() {\n    _requestDirectoryPermissionsAsync = _asyncToGenerator(function* () {\n      var initialFileUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      if (!ExponentFileSystem.requestDirectoryPermissionsAsync) {\n        throw new UnavailabilityError('expo-file-system', 'StorageAccessFramework.requestDirectoryPermissionsAsync');\n      }\n      return yield ExponentFileSystem.requestDirectoryPermissionsAsync(initialFileUrl);\n    });\n    return _requestDirectoryPermissionsAsync.apply(this, arguments);\n  }\n  StorageAccessFramework.requestDirectoryPermissionsAsync = requestDirectoryPermissionsAsync;\n  function readDirectoryAsync(_x16) {\n    return _readDirectoryAsync2.apply(this, arguments);\n  }\n  function _readDirectoryAsync2() {\n    _readDirectoryAsync2 = _asyncToGenerator(function* (dirUri) {\n      if (!ExponentFileSystem.readSAFDirectoryAsync) {\n        throw new UnavailabilityError('expo-file-system', 'StorageAccessFramework.readDirectoryAsync');\n      }\n      return yield ExponentFileSystem.readSAFDirectoryAsync(dirUri, {});\n    });\n    return _readDirectoryAsync2.apply(this, arguments);\n  }\n  StorageAccessFramework.readDirectoryAsync = readDirectoryAsync;\n  function makeDirectoryAsync(_x17, _x18) {\n    return _makeDirectoryAsync2.apply(this, arguments);\n  }\n  function _makeDirectoryAsync2() {\n    _makeDirectoryAsync2 = _asyncToGenerator(function* (parentUri, dirName) {\n      if (!ExponentFileSystem.makeSAFDirectoryAsync) {\n        throw new UnavailabilityError('expo-file-system', 'StorageAccessFramework.makeDirectoryAsync');\n      }\n      return yield ExponentFileSystem.makeSAFDirectoryAsync(parentUri, dirName);\n    });\n    return _makeDirectoryAsync2.apply(this, arguments);\n  }\n  StorageAccessFramework.makeDirectoryAsync = makeDirectoryAsync;\n  function createFileAsync(_x19, _x20, _x21) {\n    return _createFileAsync.apply(this, arguments);\n  }\n  function _createFileAsync() {\n    _createFileAsync = _asyncToGenerator(function* (parentUri, fileName, mimeType) {\n      if (!ExponentFileSystem.createSAFFileAsync) {\n        throw new UnavailabilityError('expo-file-system', 'StorageAccessFramework.createFileAsync');\n      }\n      return yield ExponentFileSystem.createSAFFileAsync(parentUri, fileName, mimeType);\n    });\n    return _createFileAsync.apply(this, arguments);\n  }\n  StorageAccessFramework.createFileAsync = createFileAsync;\n  StorageAccessFramework.writeAsStringAsync = baseWriteAsStringAsync;\n  StorageAccessFramework.readAsStringAsync = baseReadAsStringAsync;\n  StorageAccessFramework.deleteAsync = baseDeleteAsync;\n  StorageAccessFramework.moveAsync = baseMoveAsync;\n  StorageAccessFramework.copyAsync = baseCopyAsync;\n})(StorageAccessFramework || (StorageAccessFramework = {}));","map":{"version":3,"mappings":"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","names":["EventEmitter","UnavailabilityError","v4","uuidv4","ExponentFileSystem","EncodingType","FileSystemSessionType","FileSystemUploadType","console","warn","_unused","normalizeEndingSlash","p","replace","documentDirectory","cacheDirectory","bundledAssets","bundleDirectory","getInfoAsync","fileUri","options","readAsStringAsync","getContentUriAsync","Platform","OS","Promise","resolve","reject","writeAsStringAsync","contents","deleteAsync","deleteLegacyDocumentDirectoryAndroid","legacyDocumentDirectory","idempotent","moveAsync","copyAsync","makeDirectoryAsync","readDirectoryAsync","getFreeDiskStorageAsync","getTotalDiskCapacityAsync","downloadAsync","uri","sessionType","BACKGROUND","uploadAsync","url","uploadType","BINARY_CONTENT","httpMethod","toUpperCase","createDownloadResumable","callback","resumeData","DownloadResumable","createUploadTask","UploadTask","FileSystemCancellableNetworkTask","_uuid","taskWasCanceled","emitter","networkTaskCancelAsync","removeSubscription","uuid","subscription","addListener","getEventName","event","getCallback","data","uploadTaskStartAsync","isTaskCancelled","addSubscription","result","_fileUri","downloadResumableStartAsync","downloadResumablePauseAsync","pauseResult","savable","Error","baseReadAsStringAsync","baseWriteAsStringAsync","baseDeleteAsync","baseMoveAsync","baseCopyAsync","StorageAccessFramework","getUriForDirectoryInRoot","folderName","requestDirectoryPermissionsAsync","initialFileUrl","dirUri","readSAFDirectoryAsync","parentUri","dirName","makeSAFDirectoryAsync","createFileAsync","fileName","mimeType","createSAFFileAsync"],"sourceRoot":"","sources":["../src/FileSystem.ts"],"sourcesContent":["import { EventEmitter, Subscription, UnavailabilityError } from 'expo-modules-core';\nimport { Platform } from 'react-native';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport ExponentFileSystem from './ExponentFileSystem';\nimport {\n  DownloadOptions,\n  DownloadPauseState,\n  DownloadProgressCallback,\n  FileSystemNetworkTaskProgressCallback,\n  DownloadProgressData,\n  UploadProgressData,\n  DownloadResult,\n  EncodingType,\n  FileInfo,\n  FileSystemAcceptedUploadHttpMethod,\n  FileSystemDownloadResult,\n  FileSystemRequestDirectoryPermissionsResult,\n  FileSystemSessionType,\n  FileSystemUploadOptions,\n  FileSystemUploadResult,\n  FileSystemUploadType,\n  ProgressEvent,\n  ReadingOptions,\n  WritingOptions,\n} from './FileSystem.types';\n\nif (!ExponentFileSystem) {\n  console.warn(\n    \"No native ExponentFileSystem module found, are you sure the expo-file-system's module is linked properly?\"\n  );\n}\n// Prevent webpack from pruning this.\nconst _unused = new EventEmitter(ExponentFileSystem); // eslint-disable-line\n\nexport {\n  DownloadOptions,\n  DownloadPauseState,\n  DownloadProgressCallback,\n  DownloadProgressData,\n  DownloadResult,\n  EncodingType,\n  FileInfo,\n  FileSystemDownloadResult,\n  FileSystemRequestDirectoryPermissionsResult,\n  FileSystemAcceptedUploadHttpMethod,\n  FileSystemSessionType,\n  FileSystemUploadOptions,\n  FileSystemUploadResult,\n  FileSystemUploadType,\n  FileSystemNetworkTaskProgressCallback,\n  ReadingOptions,\n  WritingOptions,\n};\n\nfunction normalizeEndingSlash(p: string | null): string | null {\n  if (p != null) {\n    return p.replace(/\\/*$/, '') + '/';\n  }\n  return null;\n}\n\nexport const documentDirectory = normalizeEndingSlash(ExponentFileSystem.documentDirectory);\nexport const cacheDirectory = normalizeEndingSlash(ExponentFileSystem.cacheDirectory);\n\nexport const { bundledAssets, bundleDirectory } = ExponentFileSystem;\n\nexport async function getInfoAsync(\n  fileUri: string,\n  options: { md5?: boolean; size?: boolean } = {}\n): Promise<FileInfo> {\n  if (!ExponentFileSystem.getInfoAsync) {\n    throw new UnavailabilityError('expo-file-system', 'getInfoAsync');\n  }\n  return await ExponentFileSystem.getInfoAsync(fileUri, options);\n}\n\nexport async function readAsStringAsync(\n  fileUri: string,\n  options?: ReadingOptions\n): Promise<string> {\n  if (!ExponentFileSystem.readAsStringAsync) {\n    throw new UnavailabilityError('expo-file-system', 'readAsStringAsync');\n  }\n  return await ExponentFileSystem.readAsStringAsync(fileUri, options || {});\n}\n\nexport async function getContentUriAsync(fileUri: string): Promise<string> {\n  if (Platform.OS === 'android') {\n    if (!ExponentFileSystem.getContentUriAsync) {\n      throw new UnavailabilityError('expo-file-system', 'getContentUriAsync');\n    }\n    return await ExponentFileSystem.getContentUriAsync(fileUri);\n  } else {\n    return new Promise(function (resolve, reject) {\n      resolve(fileUri);\n    });\n  }\n}\n\nexport async function writeAsStringAsync(\n  fileUri: string,\n  contents: string,\n  options: WritingOptions = {}\n): Promise<void> {\n  if (!ExponentFileSystem.writeAsStringAsync) {\n    throw new UnavailabilityError('expo-file-system', 'writeAsStringAsync');\n  }\n  return await ExponentFileSystem.writeAsStringAsync(fileUri, contents, options);\n}\n\nexport async function deleteAsync(\n  fileUri: string,\n  options: { idempotent?: boolean } = {}\n): Promise<void> {\n  if (!ExponentFileSystem.deleteAsync) {\n    throw new UnavailabilityError('expo-file-system', 'deleteAsync');\n  }\n  return await ExponentFileSystem.deleteAsync(fileUri, options);\n}\n\nexport async function deleteLegacyDocumentDirectoryAndroid(): Promise<void> {\n  if (Platform.OS !== 'android' || documentDirectory == null) {\n    return;\n  }\n  const legacyDocumentDirectory = `${documentDirectory}ExperienceData/`;\n  return await deleteAsync(legacyDocumentDirectory, { idempotent: true });\n}\n\nexport async function moveAsync(options: { from: string; to: string }): Promise<void> {\n  if (!ExponentFileSystem.moveAsync) {\n    throw new UnavailabilityError('expo-file-system', 'moveAsync');\n  }\n  return await ExponentFileSystem.moveAsync(options);\n}\n\nexport async function copyAsync(options: { from: string; to: string }): Promise<void> {\n  if (!ExponentFileSystem.copyAsync) {\n    throw new UnavailabilityError('expo-file-system', 'copyAsync');\n  }\n  return await ExponentFileSystem.copyAsync(options);\n}\n\nexport async function makeDirectoryAsync(\n  fileUri: string,\n  options: { intermediates?: boolean } = {}\n): Promise<void> {\n  if (!ExponentFileSystem.makeDirectoryAsync) {\n    throw new UnavailabilityError('expo-file-system', 'makeDirectoryAsync');\n  }\n  return await ExponentFileSystem.makeDirectoryAsync(fileUri, options);\n}\n\nexport async function readDirectoryAsync(fileUri: string): Promise<string[]> {\n  if (!ExponentFileSystem.readDirectoryAsync) {\n    throw new UnavailabilityError('expo-file-system', 'readDirectoryAsync');\n  }\n  return await ExponentFileSystem.readDirectoryAsync(fileUri, {});\n}\n\nexport async function getFreeDiskStorageAsync(): Promise<number> {\n  if (!ExponentFileSystem.getFreeDiskStorageAsync) {\n    throw new UnavailabilityError('expo-file-system', 'getFreeDiskStorageAsync');\n  }\n  return await ExponentFileSystem.getFreeDiskStorageAsync();\n}\n\nexport async function getTotalDiskCapacityAsync(): Promise<number> {\n  if (!ExponentFileSystem.getTotalDiskCapacityAsync) {\n    throw new UnavailabilityError('expo-file-system', 'getTotalDiskCapacityAsync');\n  }\n  return await ExponentFileSystem.getTotalDiskCapacityAsync();\n}\n\nexport async function downloadAsync(\n  uri: string,\n  fileUri: string,\n  options: DownloadOptions = {}\n): Promise<FileSystemDownloadResult> {\n  if (!ExponentFileSystem.downloadAsync) {\n    throw new UnavailabilityError('expo-file-system', 'downloadAsync');\n  }\n\n  return await ExponentFileSystem.downloadAsync(uri, fileUri, {\n    sessionType: FileSystemSessionType.BACKGROUND,\n    ...options,\n  });\n}\n\nexport async function uploadAsync(\n  url: string,\n  fileUri: string,\n  options: FileSystemUploadOptions = {}\n): Promise<FileSystemUploadResult> {\n  if (!ExponentFileSystem.uploadAsync) {\n    throw new UnavailabilityError('expo-file-system', 'uploadAsync');\n  }\n\n  return await ExponentFileSystem.uploadAsync(url, fileUri, {\n    sessionType: FileSystemSessionType.BACKGROUND,\n    uploadType: FileSystemUploadType.BINARY_CONTENT,\n    ...options,\n    httpMethod: (options.httpMethod || 'POST').toUpperCase(),\n  });\n}\n\nexport function createDownloadResumable(\n  uri: string,\n  fileUri: string,\n  options?: DownloadOptions,\n  callback?: FileSystemNetworkTaskProgressCallback<DownloadProgressData>,\n  resumeData?: string\n): DownloadResumable {\n  return new DownloadResumable(uri, fileUri, options, callback, resumeData);\n}\n\nexport function createUploadTask(\n  url: string,\n  fileUri: string,\n  options?: FileSystemUploadOptions,\n  callback?: FileSystemNetworkTaskProgressCallback<UploadProgressData>\n): UploadTask {\n  return new UploadTask(url, fileUri, options, callback);\n}\n\nexport abstract class FileSystemCancellableNetworkTask<\n  T extends DownloadProgressData | UploadProgressData\n> {\n  private _uuid = uuidv4();\n  protected taskWasCanceled = false;\n  private emitter = new EventEmitter(ExponentFileSystem);\n  private subscription?: Subscription | null;\n\n  public async cancelAsync(): Promise<void> {\n    if (!ExponentFileSystem.networkTaskCancelAsync) {\n      throw new UnavailabilityError('expo-file-system', 'networkTaskCancelAsync');\n    }\n\n    this.removeSubscription();\n    this.taskWasCanceled = true;\n    return await ExponentFileSystem.networkTaskCancelAsync(this.uuid);\n  }\n\n  protected isTaskCancelled(): boolean {\n    if (this.taskWasCanceled) {\n      console.warn('This task was already canceled.');\n      return true;\n    }\n\n    return false;\n  }\n\n  protected get uuid(): string {\n    return this._uuid;\n  }\n\n  protected abstract getEventName(): string;\n\n  protected abstract getCallback(): FileSystemNetworkTaskProgressCallback<T> | undefined;\n\n  protected addSubscription() {\n    if (this.subscription) {\n      return;\n    }\n\n    this.subscription = this.emitter.addListener(this.getEventName(), (event: ProgressEvent<T>) => {\n      if (event.uuid === this.uuid) {\n        const callback = this.getCallback();\n        if (callback) {\n          callback(event.data);\n        }\n      }\n    });\n  }\n\n  protected removeSubscription() {\n    if (!this.subscription) {\n      return;\n    }\n    this.emitter.removeSubscription(this.subscription);\n    this.subscription = null;\n  }\n}\n\nexport class UploadTask extends FileSystemCancellableNetworkTask<UploadProgressData> {\n  private options: FileSystemUploadOptions;\n\n  constructor(\n    private url: string,\n    private fileUri: string,\n    options?: FileSystemUploadOptions,\n    private callback?: FileSystemNetworkTaskProgressCallback<UploadProgressData>\n  ) {\n    super();\n\n    const httpMethod = (options?.httpMethod?.toUpperCase() ||\n      'POST') as FileSystemAcceptedUploadHttpMethod;\n\n    this.options = {\n      sessionType: FileSystemSessionType.BACKGROUND,\n      uploadType: FileSystemUploadType.BINARY_CONTENT,\n      ...options,\n      httpMethod,\n    };\n  }\n\n  protected getEventName(): string {\n    return 'expo-file-system.uploadProgress';\n  }\n  protected getCallback(): FileSystemNetworkTaskProgressCallback<UploadProgressData> | undefined {\n    return this.callback;\n  }\n\n  public async uploadAsync(): Promise<FileSystemUploadResult | undefined> {\n    if (!ExponentFileSystem.uploadTaskStartAsync) {\n      throw new UnavailabilityError('expo-file-system', 'uploadTaskStartAsync');\n    }\n\n    if (this.isTaskCancelled()) {\n      return;\n    }\n\n    this.addSubscription();\n    const result = await ExponentFileSystem.uploadTaskStartAsync(\n      this.url,\n      this.fileUri,\n      this.uuid,\n      this.options\n    );\n    this.removeSubscription();\n\n    return result;\n  }\n}\n\nexport class DownloadResumable extends FileSystemCancellableNetworkTask<DownloadProgressData> {\n  constructor(\n    private url: string,\n    private _fileUri: string,\n    private options: DownloadOptions = {},\n    private callback?: FileSystemNetworkTaskProgressCallback<DownloadProgressData>,\n    private resumeData?: string\n  ) {\n    super();\n  }\n\n  public get fileUri(): string {\n    return this._fileUri;\n  }\n\n  protected getEventName(): string {\n    return 'expo-file-system.downloadProgress';\n  }\n\n  protected getCallback(): FileSystemNetworkTaskProgressCallback<DownloadProgressData> | undefined {\n    return this.callback;\n  }\n\n  async downloadAsync(): Promise<FileSystemDownloadResult | undefined> {\n    if (!ExponentFileSystem.downloadResumableStartAsync) {\n      throw new UnavailabilityError('expo-file-system', 'downloadResumableStartAsync');\n    }\n\n    if (this.isTaskCancelled()) {\n      return;\n    }\n\n    this.addSubscription();\n    return await ExponentFileSystem.downloadResumableStartAsync(\n      this.url,\n      this._fileUri,\n      this.uuid,\n      this.options,\n      this.resumeData\n    );\n  }\n\n  async pauseAsync(): Promise<DownloadPauseState> {\n    if (!ExponentFileSystem.downloadResumablePauseAsync) {\n      throw new UnavailabilityError('expo-file-system', 'downloadResumablePauseAsync');\n    }\n\n    if (this.isTaskCancelled()) {\n      return {\n        fileUri: this._fileUri,\n        options: this.options,\n        url: this.url,\n      };\n    }\n\n    const pauseResult = await ExponentFileSystem.downloadResumablePauseAsync(this.uuid);\n    this.removeSubscription();\n    if (pauseResult) {\n      this.resumeData = pauseResult.resumeData;\n      return this.savable();\n    } else {\n      throw new Error('Unable to generate a savable pause state');\n    }\n  }\n\n  async resumeAsync(): Promise<FileSystemDownloadResult | undefined> {\n    if (!ExponentFileSystem.downloadResumableStartAsync) {\n      throw new UnavailabilityError('expo-file-system', 'downloadResumableStartAsync');\n    }\n\n    if (this.isTaskCancelled()) {\n      return;\n    }\n\n    this.addSubscription();\n    return await ExponentFileSystem.downloadResumableStartAsync(\n      this.url,\n      this.fileUri,\n      this.uuid,\n      this.options,\n      this.resumeData\n    );\n  }\n\n  savable(): DownloadPauseState {\n    return {\n      url: this.url,\n      fileUri: this.fileUri,\n      options: this.options,\n      resumeData: this.resumeData,\n    };\n  }\n}\n\nconst baseReadAsStringAsync = readAsStringAsync;\nconst baseWriteAsStringAsync = writeAsStringAsync;\nconst baseDeleteAsync = deleteAsync;\nconst baseMoveAsync = moveAsync;\nconst baseCopyAsync = copyAsync;\n/**\n * Android only\n */\nexport namespace StorageAccessFramework {\n  export function getUriForDirectoryInRoot(folderName: string) {\n    return `content://com.android.externalstorage.documents/tree/primary:${folderName}/document/primary:${folderName}`;\n  }\n\n  export async function requestDirectoryPermissionsAsync(\n    initialFileUrl: string | null = null\n  ): Promise<FileSystemRequestDirectoryPermissionsResult> {\n    if (!ExponentFileSystem.requestDirectoryPermissionsAsync) {\n      throw new UnavailabilityError(\n        'expo-file-system',\n        'StorageAccessFramework.requestDirectoryPermissionsAsync'\n      );\n    }\n\n    return await ExponentFileSystem.requestDirectoryPermissionsAsync(initialFileUrl);\n  }\n\n  export async function readDirectoryAsync(dirUri: string): Promise<string[]> {\n    if (!ExponentFileSystem.readSAFDirectoryAsync) {\n      throw new UnavailabilityError(\n        'expo-file-system',\n        'StorageAccessFramework.readDirectoryAsync'\n      );\n    }\n    return await ExponentFileSystem.readSAFDirectoryAsync(dirUri, {});\n  }\n\n  export async function makeDirectoryAsync(parentUri: string, dirName: string): Promise<string> {\n    if (!ExponentFileSystem.makeSAFDirectoryAsync) {\n      throw new UnavailabilityError(\n        'expo-file-system',\n        'StorageAccessFramework.makeDirectoryAsync'\n      );\n    }\n    return await ExponentFileSystem.makeSAFDirectoryAsync(parentUri, dirName);\n  }\n\n  export async function createFileAsync(\n    parentUri: string,\n    fileName: string,\n    mimeType: string\n  ): Promise<string> {\n    if (!ExponentFileSystem.createSAFFileAsync) {\n      throw new UnavailabilityError('expo-file-system', 'StorageAccessFramework.createFileAsync');\n    }\n    return await ExponentFileSystem.createSAFFileAsync(parentUri, fileName, mimeType);\n  }\n\n  export const writeAsStringAsync = baseWriteAsStringAsync;\n  export const readAsStringAsync = baseReadAsStringAsync;\n  export const deleteAsync = baseDeleteAsync;\n  export const moveAsync = baseMoveAsync;\n  export const copyAsync = baseCopyAsync;\n}\n"]},"metadata":{},"sourceType":"module"}